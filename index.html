<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Groq Voice Bot ‚Äî –ê—Å–∏—Å—Ç–µ–Ω—Ç</title>
  <script src="https://code.responsivevoice.org/responsivevoice.js?key=FmSmJQPV"></script>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: sans-serif;
      margin: 20px;
    }
    h1 {
      color: #0f0;
      margin-bottom: 10px;
    }
    #chat-box {
      background: #222;
      border: 1px solid #444;
      height: 400px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
      white-space: pre-wrap;
      display: flex;
      flex-direction: column;
    }
    .message {
      margin-bottom: 8px;
      padding: 6px 10px;
      border-radius: 6px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .user {
      background: #0a84ff22;
      color: #aaf;
      align-self: flex-end;
      margin-left: auto;
    }
    .bot {
      background: #28a74533;
      color: #8f8;
      align-self: flex-start;
      margin-right: auto;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 8px;
    }
    select, textarea, button {
      background: #222;
      color: #eee;
      border: 1px solid #555;
      padding: 6px;
      font-size: 1rem;
      border-radius: 4px;
    }
    select {
      min-width: 180px;
    }
    textarea {
      width: 100%;
      resize: vertical;
      min-height: 70px;
    }
    button {
      cursor: pointer;
      min-width: 120px;
    }
    #status {
      font-size: 0.9rem;
      color: #ccc;
      margin-bottom: 6px;
      min-height: 20px;
    }
  </style>
</head>
<body>

  <h1>ü§ñ Groq Voice Bot ‚Äî –ê—Å–∏—Å—Ç–µ–Ω—Ç</h1>

  <div id="controls">
    <label for="language">–ú–æ–≤–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è:</label>
    <select id="language" title="–ú–æ–≤–∞ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–µ–¥–µ–Ω–Ω—è">
      <option value="uk-UA" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ üá∫üá¶</option>
      <option value="ru-RU">–†–æ—Å—ñ–π—Å—å–∫–∞ üá∑üá∫</option>
      <option value="en-US">–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ üá¨üáß</option>
    </select>

    <label for="model">–ú–æ–¥–µ–ª—å LLM:</label>
    <select id="model" title="–í–∏–±—ñ—Ä –º–æ–¥–µ–ª—ñ">
      <option value="llama3-70b-8192" selected>LLaMA 3 (70B)</option>
      <option value="llama3-8b-8192">LLaMA 3 (8B)</option>
      <option value="meta-llama/llama-4-maverick-17b-128e-instruct">LLaMA 4 Maverick (17B)</option>
      <option value="deepseek-r1-distill-llama-70b">DeepSeek Distill 70B</option>
      <option value="gemma2-9b-it">Gemma 2 (9B IT)</option>
    </select>

    <label for="voice" style="display:none;">–ì–æ–ª–æ—Å –æ–∑–≤—É—á–µ–Ω–Ω—è:</label>
    <select id="voice" title="–ì–æ–ª–æ—Å –¥–ª—è –æ–∑–≤—É—á–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ" style="display:none;">
      <option value="Ukrainian Female" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –ñ—ñ–Ω–æ—á–∞</option>
      <option value="Ukrainian Male">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –ß–æ–ª–æ–≤—ñ—á–∞</option>
      <option value="Russian Female">–†–æ—Å—ñ–π—Å—å–∫–∞ –ñ—ñ–Ω–æ—á–∞</option>
      <option value="UK English Female">–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ –ñ—ñ–Ω–æ—á–∞</option>
      <option value="UK English Male">–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ –ß–æ–ª–æ–≤—ñ—á–∞</option>
    </select>
  </div>

  <div id="chat-box" aria-live="polite" aria-label="–Ü—Å—Ç–æ—Ä—ñ—è —á–∞—Ç—É"></div>

  <div id="status"></div>

  <textarea id="user-input" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å üéôÔ∏è —ñ –≥–æ–≤–æ—Ä—ñ—Ç—å..." rows="3" aria-label="–ü–æ–ª–µ –≤–≤–µ–¥–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"></textarea>

  <div id="controls" style="margin-top: 8px;">
    <button id="btn-send">üì© –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
    <button id="btn-voice">üéôÔ∏è –ì–æ–ª–æ—Å–æ–º</button>
    <button id="btn-clear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ —á–∞—Ç</button>
    <button id="btn-speak">üîä –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –≥–æ–ª–æ—Å–æ–º</button>
  </div>

  <script>
    const chatBox = document.getElementById("chat-box");
    const userInput = document.getElementById("user-input");
    const btnSend = document.getElementById("btn-send");
    const btnVoice = document.getElementById("btn-voice");
    const btnClear = document.getElementById("btn-clear");
    const btnSpeak = document.getElementById("btn-speak");
    const languageSelect = document.getElementById("language");
    const modelSelect = document.getElementById("model");
    const voiceSelect = document.getElementById("voice");
    const statusDiv = document.getElementById("status");

    let lastBotResponse = "";
    let recognition = null;
    let recognizing = false;

    // –î–æ–¥–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç
    function appendMessage(sender, text) {
      const msgDiv = document.createElement("div");
      msgDiv.className = "message " + (sender === "user" ? "user" : "bot");
      msgDiv.textContent = (sender === "user" ? "üßë: " : "ü§ñ: ") + text;
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ API
    async function sendMessage(text) {
      appendMessage("user", text);
      statusDiv.textContent = "‚è≥ –û—á—ñ–∫—É—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å...";
      btnSend.disabled = true;
      btnVoice.disabled = true;

      const model = modelSelect.value;
      const lang = languageSelect.value;
      const systemPrompt = lang.startsWith("ru") 
        ? "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –û—Ç–≤–µ—á–∞–π —á–µ—Ç–∫–æ –∏ –∫—Ä–∞—Ç–∫–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤." 
        : lang.startsWith("en") 
          ? "You are a helpful assistant. Please respond clearly and concisely, no filler words." 
          : "–¢–∏ –∫–æ—Ä–∏—Å–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π —á—ñ—Ç–∫–æ —ñ –∫–æ—Ä–æ—Ç–∫–æ, –±–µ–∑ –∑–∞–π–≤–∏—Ö —Å–ª—ñ–≤.";

      const payload = {
        model,
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user", content: text }
        ],
        temperature: 0.3,
        max_tokens: 512
      };

      try {
        const res = await fetch("https://my-ai-worker.valeraiva2020.workers.dev/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          throw new Error("–ü–æ–º–∏–ª–∫–∞ API: " + res.status);
        }

        const data = await res.json();
        // –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ —Ç–≤—ñ–π –≤–æ—Ä–∫–µ—Ä –ø–æ–≤–µ—Ä—Ç–∞—î { response: "—Ç–µ–∫—Å—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ" }
        const botText = data.response?.trim() || "‚ö†Ô∏è –ü–æ—Ä–æ–∂–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å";

        appendMessage("bot", botText);
        lastBotResponse = botText;
        statusDiv.textContent = "";

        // –û–∑–≤—É—á–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
        speak(botText, lang);
      } catch (err) {
        appendMessage("bot", "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞: " + err.message);
        statusDiv.textContent = "";
      } finally {
        btnSend.disabled = false;
        btnVoice.disabled = false;
      }
    }

    // –û–∑–≤—É—á–∏—Ç–∏ —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ responsiveVoice
    function speak(text, lang) {
      const voiceMap = {
        "uk-UA": "Ukrainian Female",
        "ru-RU": "Russian Female",
        "en-US": "UK English Female"
      };
      const voiceName = voiceMap[lang] || "Ukrainian Female";
      if (responsiveVoice.voiceSupport()) {
        responsiveVoice.speak(text, voiceName);
      }
    }

    // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–ª—ñ–∫—É
    btnSend.addEventListener("click", () => {
      const text = userInput.value.trim();
      if (text) {
        userInput.value = "";
        sendMessage(text);
      }
    });

    // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ Enter (–±–µ–∑ Shift)
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        btnSend.click();
      }
    });

    // –û—á–∏—Å—Ç–∏—Ç–∏ —á–∞—Ç
    btnClear.addEventListener("click", () => {
      chatBox.innerHTML = "";
      lastBotResponse = "";
      statusDiv.textContent = "";
    });

    // –û–∑–≤—É—á–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    btnSpeak.addEventListener("click", () => {
      if (lastBotResponse) {
        speak(lastBotResponse, languageSelect.value);
      }
    });

    // –ì–æ–ª–æ—Å–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—è (Web Speech API)
    btnVoice.addEventListener("click", () => {
      if (!('webkitSpeechRecognition' in window)) {
        alert("–ì–æ–ª–æ—Å–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º.");
        return;
      }

      if (recognizing) {
        recognition.stop();
        return;
      }

      recognition = new webkitSpeechRecognition();
      recognition.lang = languageSelect.value;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => {
        recognizing = true;
        statusDiv.textContent = "üé§ –ì–æ–≤–æ—Ä—ñ—Ç—å...";
        btnVoice.textContent = "‚ñ† –ó—É–ø–∏–Ω–∏—Ç–∏";
        btnSend.disabled = true;
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        recognition.stop();
        sendMessage(transcript);
      };

      recognition.onerror = (event) => {
        alert("–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –≥–æ–ª–æ—Å—É: " + event.error);
        recognizing = false;
        btnVoice.textContent = "üéôÔ∏è –ì–æ–ª–æ—Å–æ–º";
        btnSend.disabled = false;
        statusDiv.textContent = "";
      };

      recognition.onend = () => {
        recognizing = false;
        btnVoice.textContent = "üéôÔ∏è –ì–æ–ª–æ—Å–æ–º";
        btnSend.disabled = false;
        if (!userInput.value) {
          statusDiv.textContent = "";
        }
      };

      recognition.start();
    });
  </script>
</body>
</html>
